<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>مشغل سينمائي شامل</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
  body {
    margin: 0; font-family: 'Tajawal', sans-serif;
    background-color: #18191c; color: #e4e6eb;
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    min-height: 100vh;
  }
  h2 { margin: 20px 0 10px; text-align: center; }
  #player-container {
    position: relative; width: 90%; max-width: 800px; aspect-ratio: 16/9; background: #000; border-radius: 10px; overflow: hidden;
    margin-bottom: 10px;
  }
  #video-element, iframe { width: 100%; height: 100%; border: none; display: block; }
  #controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
  #url-input { padding: 8px; border-radius: 5px; border: 1px solid #555; width: 250px; background: #242526; color: #e4e6eb; }
  #load-btn, #file-btn { padding: 8px 12px; border: none; border-radius: 5px; background-color: #1a73e8; color: white; cursor: pointer; }
  #load-btn:hover, #file-btn:hover { background-color: #1558b0; }
  #twitter-selector { display:flex; gap:5px; flex-wrap:wrap; justify-content:center; margin-top:5px; }
  #twitter-selector button { padding:4px 8px; background:#333; border:none; border-radius:5px; cursor:pointer; color:white; }
  #twitter-selector button.active { background:#1a73e8; }
</style>
</head>
<body>

<h2>مشغل سينمائي شامل</h2>
<div id="player-container">
  <video id="video-element" controls autoplay muted></video>
</div>
<div id="twitter-selector"></div>

<div id="controls">
  <input type="text" id="url-input" placeholder="أدخل رابط YouTube / Twitter / M3U8 / MP4">
  <button id="load-btn">تشغيل الرابط</button>
  <input type="file" id="file-input" accept="video/*" style="display:none;">
  <button id="file-btn">رفع ملف فيديو</button>
</div>

<script>
const videoContainer = document.getElementById('player-container');
const videoEl = document.getElementById('video-element');
const urlInput = document.getElementById('url-input');
const loadBtn = document.getElementById('load-btn');
const fileInput = document.getElementById('file-input');
const fileBtn = document.getElementById('file-btn');
const twitterSelector = document.getElementById('twitter-selector');

// --- دوال مساعدة ---
function isYouTube(url) { return /(?:youtube\.com|youtu\.be)/.test(url); }
function getYouTubeID(url) { const match = url.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})/); return match ? match[1] : null; }
function isTwitter(url) { return /(?:twitter|x)\.com/.test(url); }
function isDirectVideo(url) { return /\.(mp4|webm|ogg)$/.test(url); }
function isM3U8(url) { return /\.m3u8$/i.test(url); }

// --- تشغيل الرابط ---
loadBtn.onclick = async () => {
  const url = urlInput.value.trim();
  if (!url) return;

  videoEl.pause(); videoEl.src = '';
  videoEl.style.display = 'block';
  videoContainer.innerHTML = ''; 
  videoContainer.appendChild(videoEl);
  twitterSelector.innerHTML = '';

  if (isYouTube(url)) {
    const id = getYouTubeID(url);
    if (id) {
      const iframe = document.createElement('iframe');
      iframe.src = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1`;
      iframe.allow = "autoplay; encrypted-media"; iframe.allowFullscreen = true;
      videoEl.style.display = 'none';
      videoContainer.appendChild(iframe);
    } else alert('رابط يوتيوب غير صالح');
  } 
  else if (isTwitter(url)) {
    try {
      const idMatch = url.match(/status\/(\d+)/);
      if (!idMatch) { alert('رابط تويتر غير صالح'); return; }
      const id = idMatch[1];
      const resp = await fetch(`https://api.vxtwitter.com/i/status/${id}`);
      const data = await resp.json();
      if (!data.media_extended || data.media_extended.length === 0) { alert('لم يتم العثور على فيديو'); return; }

      // --- إضافة اختيار المقطع ---
      data.media_extended.forEach((item, index) => {
        const btn = document.createElement('button');
        btn.textContent = `المقطع ${index+1}`;
        btn.onclick = () => {
          twitterSelector.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          videoEl.src = item.url; videoEl.play();
        };
        twitterSelector.appendChild(btn);
      });
      // تشغيل المقطع الأول تلقائياً
      twitterSelector.querySelector('button').click();

    } catch(e) { alert('خطأ في تحميل فيديو تويتر'); console.error(e); }
  }
  else if (isM3U8(url)) {
    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(url); hls.attachMedia(videoEl);
      videoEl.play();
    } else alert('M3U8 غير مدعوم في هذا المتصفح');
  }
  else if (isDirectVideo(url)) {
    videoEl.src = url; videoEl.play();
  }
  else alert('نوع الرابط غير مدعوم');
};

// --- رفع ملف ---
fileBtn.onclick = () => fileInput.click();
fileInput.onchange = () => {
  const file = fileInput.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  videoEl.src = url; videoEl.play();
  twitterSelector.innerHTML = '';
};
</script>

</body>
</html>
